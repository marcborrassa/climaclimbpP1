<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>API</title>
    <style>
        #mun,
textarea {
  height: 40px;
  padding: 0 16px;
  font-family: "Roboto Condensed", sans-serif;
  font-size: 20px;
  border: 2px;
  background-color: #ffe268;
    </style>
    <style>
        p {
  line-height: 1.5;
  text-align: justify;
    font-family: "Roboto Condensed", sans-serif;
  margin: 20px;
    </style>
    <style>
        h1 {
  margin: 0;
  font-size: 22px;
  font-family: "Roboto Slab", serif;
}
    </style>
    <link href="https://fonts.googleapis.com/css?family=Roboto|Roboto+Condensed|Roboto+Slab" rel="stylesheet">
</head>
<body>

<label for="mun"><h1>Veure l'estat i la previsió meteorològica:</h1></label>
<br>
<select name="mun" onchange="modifyWeather()" id="mun">
    <option selected="true" disabled="disabled"> Sel·lecciona una opció</option>
    <option value="43171">Arbolí</option>
    <option value="43049">Siurana</option>
    <option value="47002">Margalef</option>
</select>
<br>
<div id="app"><div>

        <script>
function modifyWeather() {
    const muni_nom = document.getElementById('mun').value;

    // Write Javascript code!
    const appDiv = document.getElementById('app');
    //appDiv.innerHTML = `<h1>JS Starter</h1>`;


    //API key Marc:
    const xhr = new XMLHttpRequest();
    xhr.open('GET', 'https://opendata.aemet.es/opendata/api/prediccion/especifica/municipio/horaria/' + muni_nom + '?api_key=eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJiZW5pdG8uemFyYWdvemlAdXJ2LmNhdCIsImp0aSI6IjdhNDg3NDAyLThjOGItNDIzNC1iNjM1LTljODg5YzI2YzI5ZiIsImlzcyI6IkFFTUVUIiwiaWF0IjoxNjIwNzUzNTEwLCJ1c2VySWQiOiI3YTQ4NzQwMi04YzhiLTQyMzQtYjYzNS05Yzg4OWMyNmMyOWYiLCJyb2xlIjoiIn0.qK66glH1Meim9bDpHW59FkVBIcMbleIGN1X9XKhGXnA');

    xhr.onload = function(e) {
        if (this.status == 200) {
            var response = JSON.parse(this.response);
            var dataurl = response.datos;

            console.log(this.response);

            function Get(yourUrl) {
                var Httpreq = new XMLHttpRequest(); // a new request
                Httpreq.open("GET", yourUrl, false);
                Httpreq.send(null);
                return Httpreq.responseText;
            }

            var json_doc = Get(dataurl)
            var json_obj = JSON.parse(json_doc);
            var sky_status = json_obj[0]["prediccion"]["dia"][0]["estadoCielo"][0]["descripcion"];
            var rain = json_obj[0]["prediccion"]["dia"][0]["precipitacion"][0]["value"];
            var probPrec = json_obj[0]["prediccion"]["dia"][0]["probPrecipitacion"][0]["value"];
            var tor = json_obj[0]["prediccion"]["dia"][0]["probTormenta"][0]["value"];
            var temp = json_obj[0]["prediccion"]["dia"][0]["temperatura"][0]["value"];
            var temp = json_obj[0]["prediccion"]["dia"][0]["temperatura"][0]["value"];
            var vent = json_obj[0]["prediccion"]["dia"][0]["vientoAndRachaMax"][0]["direccion"];
            var velVent = json_obj[0]["prediccion"]["dia"][0]["vientoAndRachaMax"][0]["velocidad"];

            console.log("Estat del cel a les XX:XX: " + sky_status);

            appDiv.innerHTML = "<p>" + "Estat del cel: " + sky_status + "<br> Precipitació: " + rain + "<br> Probabilita de pluja: " + probPrec + "<br> Probabilita de tempesta: " + tor + "<br> Temperatura: " + temp + "ºC" + "<br> Ràfaga de vent: " + vent + " Velocitat " + velVent + "Km/h" + "</p>";
        }
    };
    xhr.send();
}
        </script>

</body>
</html>